var YAAW=(function(){var d=false;var c=null;var a=null,b=null;return{init:function(){this.tpl.init();this.setting.init();this.contextmenu.init();this.event_init();this.aria2_init()},aria2_init:function(){ARIA2.init(this.setting.jsonrpc_path,function(){if(YAAW.setting.add_task_option){$("#add-task-option-wrap").empty().append(YAAW.tpl.add_task_option(YAAW.setting.add_task_option))}else{ARIA2.init_add_task_option()}ARIA2.refresh();ARIA2.auto_refresh(YAAW.setting.refresh_interval);ARIA2.get_version();ARIA2.global_stat()})},event_init:function(){$("[rel=tooltip]").tooltip({placement:"bottom"});$(".task .select-box").live("click",function(){YAAW.tasks.toggle($(this).parents(".task"));YAAW.tasks.check_select()});$(".task .task-name > span").live("click",function(){var i=$(this).parents(".task");if(i.hasClass("info-open")){YAAW.tasks.info_close()}else{YAAW.tasks.info_close();YAAW.tasks.info(i)}});$("#uri-more").click(function(){$("#add-task-uri .input-append").toggle();$("#uri-textarea").toggle();$("#uri-more .or-and").toggle();$("#uri-input").val("");$("#uri-textarea").val("");$("#ati-out").parents(".control-group").val("").toggle()});$("#ib-files li").live("click",function(){$(this).find(".select-box").toggleClass("icon-ok")});$("#ib-file-save").live("click",function(){var j=[];$("#ib-files .select-box.icon-ok").each(function(k,l){j.push(l.getAttribute("data-index"))});if(j.length==0){ARIA2.main_alert("alert-error","At least one file should be selected. Or just stop the task.",5000)}else{var i={"select-file":j.join(","),};ARIA2.change_option($(this).parents(".info-box").attr("data-gid"),i)}});$("#ib-file-select").live("click",function(){$("#ib-files .select-box").addClass("icon-ok")});$("#ib-file-unselect").live("click",function(){$("#ib-files .select-box").removeClass("icon-ok")});$("#ib-options-a").live("click",function(){ARIA2.get_options($(".info-box").attr("data-gid"))});var e=["max-download-limit","max-upload-limit"];$("#ib-options-save").live("click",function(){var j={};var k=$(this).parents(".info-box").attr("data-gid");var i=$("#task-gid-"+k).attr("data-status");$.each($("#ib-options-form input"),function(m,l){if(i=="active"&&e.indexOf(l.name)==-1){return}j[l.name]=l.value});ARIA2.change_options($(".info-box").attr("data-gid"),j)});$("#select-all-btn").click(function(){if(d){YAAW.tasks.unSelectAll()}else{YAAW.tasks.selectAll()}});$("#refresh-btn").click(function(){YAAW.tasks.unSelectAll();YAAW.tasks.info_close();$("#main-alert").hide();ARIA2.refresh();return false});$("#setting-modal").on("show",function(){ARIA2.get_global_option()});if(window.FileReader){var f=$("#add-task-modal .modal-body").get(0);f.ondragover=function(){$(this).addClass("hover");return false};f.ondragend=function(){$(this).removeClass("hover");return false};f.ondrop=function(j){$(this).removeClass("hover");j.preventDefault();var i=j.dataTransfer.files[0];YAAW.add_task.upload(i);return false};var h=$("#torrent-up-input").get(0);h.onchange=function(j){var i=j.target.files[0];YAAW.add_task.upload(i)}}else{$("#torrent-up-input").remove();$("#torrent-up-btn").addClass("disabled")}if(window.applicationCache){var g=window.applicationCache;$(document).ready(function(){if(g.status==g.IDLE){$("#offline-cached").text("cached")}});g.addEventListener("cached",function(){$("#offline-cached").text("cached")})}},tpl:{init:function(){var e=this;$("script[type='text/mustache-template']").each(function(g,h){var f=h.getAttribute("id").replace(/-tpl$/,"").replace(/-/g,"_");e[f]=function(){var i=Mustache.compile($(h).text());return function(j){j._v=e.view;return i(j)}}()})},view:{bitfield:function(){return function(h){var f=h.length;var e="";var j="░▒▓█";for(var g=0;g<f;g++){e+=j[Math.floor(parseInt(h[g],16)/4)]+"&#8203;"}return e}},format_size:function(){var f=["B","KB","MB","GB","TB",];return function e(h){if(h===""){return""}h=parseInt(h);var g=0;while(h>=1024){h/=1024;g++}if(h==0){return"0 KB"}else{return h.toFixed(2)+" "+f[g]}}},format_size_0:function(){var f=["B","KB","MB","GB","TB",];return function e(h){if(h===""){return""}h=parseInt(h);var g=0;while(h>=1024){h/=1024;g++}if(h==0){return"0 KB"}else{return h.toFixed(0)+" "+f[g]}}},format_time:function(){var e=[60,60,24];var g=["s","m","h"];return function f(k){if(k==Infinity){return"INF"}else{if(k==0){return"0s"}}k=Math.floor(k);var j=0;var h="";while(k>0&&j<3){h=k%e[j]+g[j]+h;k=Math.floor(k/e[j]);j++}if(k>0){h=k+"d"+h}return h}},error_msg:function(){var e={0:"",1:"unknown error occurred.",2:"time out occurred.",3:"resource was not found.",4:"resource was not found. See --max-file-not-found option.",5:"resource was not found. See --lowest-speed-limit option.",6:"network problem occurred.",7:"unfinished download.",8:"remote server did not support resume when resume was required to complete download.",9:"there was not enough disk space available.",10:"piece length was different from one in .aria2 control file. See --allow-piece-length-change option.",11:"aria2 was downloading same file at that moment.",12:"aria2 was downloading same info hash torrent at that moment.",13:"file already existed. See --allow-overwrite option.",14:"renaming file failed. See --auto-file-renaming option.",15:"aria2 could not open existing file.",16:"aria2 could not create new file or truncate existing file.",17:"I/O error occurred.",18:"aria2 could not create directory.",19:"name resolution failed.",20:"could not parse Metalink document.",21:"FTP command failed.",22:"HTTP response header was bad or unexpected.",23:"too many redirections occurred.",24:"HTTP authorization failed.",25:"aria2 could not parse bencoded file(usually .torrent file).",26:".torrent file was corrupted or missing information that aria2 needed.",27:"Magnet URI was bad.",28:"bad/unrecognized option was given or unexpected option argument was given.",29:"the remote server was unable to handle the request due to a temporary overloading or maintenance.",30:"aria2 could not parse JSON-RPC request.",};return function(f){return e[f]||""}},status_icon:function(){var e={active:"icon-download-alt",waiting:"icon-time",paused:"icon-pause",error:"icon-remove",complete:"icon-ok",removed:"icon-trash",};return function(f){return e[f]||""}},},},add_task:{submit:function(h){var g=$("#uri-input").val()||$("#uri-textarea").val()&&$("#uri-textarea").val().split("\n");var f={},e={};$("#add-task-option input[name], #add-task-option textarea[name]").each(function(k,m){var j=m.getAttribute("name");var l=(m.type=="checkbox"?m.checked:m.value);if(j&&l){f[j]=String(l);if($(m).hasClass("input-save")){e[j]=String(l)}}});if(g){ARIA2.madd_task(g,f);YAAW.setting.save_add_task_option(e)}else{if(a){if(b.indexOf("metalink")!=-1){ARIA2.add_metalink(a,f)}else{ARIA2.add_torrent(a,f)}YAAW.setting.save_add_task_option(e)}}},clean:function(){$("#uri-input").attr("placeholder","HTTP, FTP or Magnet");$("#add-task-modal .input-clear").val("");$("#add-task-alert").hide();a=null;b=null},upload:function(f){var e=new FileReader();e.onload=function(g){$("#uri-input").attr("placeholder",f.name);a=g.target.result.replace(/.*?base64,/,"");b=f.type};e.onerror=function(g){$("#torrent-up-input").remove();$("#torrent-up-btn").addClass("disabled")};e.readAsDataURL(f)},},tasks:{check_select:function(){var e=$(".tasks-table .task.selected");if(e.length==0){d=false;$("#select-btn .select-box").removeClass("icon-minus icon-ok")}else{if(e.length<$(".tasks-table .task").length){d=true;$("#select-btn .select-box").removeClass("icon-ok").addClass("icon-minus")}else{d=true;$("#select-btn .select-box").removeClass("icon-minus").addClass("icon-ok")}}if(e.length+$(".info-box").length==0){ARIA2.select_lock(false)}else{ARIA2.select_lock(true)}if(d){$("#not-selected-grp").hide();$("#selected-grp").show()}else{$("#not-selected-grp").show();$("#selected-grp").hide()}},select:function(e){$(e).addClass("selected").find(".select-box").addClass("icon-ok")},unSelect:function(e){$(e).removeClass("selected").find(".select-box").removeClass("icon-ok")},toggle:function(e){$(e).toggleClass("selected").find(".select-box").toggleClass("icon-ok")},unSelectAll:function(e){var f=this;$(".tasks-table .task.selected").each(function(g,h){f.unSelect(h)});if(!e){this.check_select()}},selectAll:function(){var e=this;$(".tasks-table .task").each(function(f,g){e.select(g)});this.check_select()},selectActive:function(){var e=this;this.unSelectAll(true);$(".tasks-table .task[data-status=active]").each(function(f,g){e.select(g)});this.check_select()},selectWaiting:function(){var e=this;this.unSelectAll(true);$(".tasks-table .task[data-status=waiting]").each(function(f,g){e.select(g)});this.check_select()},selectPaused:function(){var e=this;this.unSelectAll(true);$(".tasks-table .task[data-status=paused]").each(function(f,g){e.select(g)});this.check_select()},selectStoped:function(){var e=this;this.unSelectAll(true);$("#stoped-tasks-table .task").each(function(f,g){e.select(g)});this.check_select()},getSelectedGids:function(){var e=new Array();$(".tasks-table .task.selected").each(function(f,g){e.push(g.getAttribute("data-gid"))});return e},pause:function(){var e=new Array();$(".tasks-table .task.selected").each(function(f,g){if(g.getAttribute("data-status")=="active"||g.getAttribute("data-status")=="waiting"){e.push(g.getAttribute("data-gid"))}});if(e.length){ARIA2.pause(this.getSelectedGids())}},unpause:function(){var e=new Array();var f=new Array();$(".tasks-table .task.selected").each(function(h,j){var g=j.getAttribute("data-status");if(g=="paused"){e.push(j.getAttribute("data-gid"))}else{if("removed/error".indexOf(g)!=-1){f.push(j.getAttribute("data-gid"))}}});if(e.length){ARIA2.unpause(e)}if(f.length){ARIA2.restart_task(f)}},remove:function(){var f=new Array();var e=["active","waiting","paused"];var g=new Array();$(".tasks-table .task.selected").each(function(h,j){if(e.indexOf(j.getAttribute("data-status"))!=-1){g.push(j.getAttribute("data-gid"))}else{f.push(j.getAttribute("data-gid"))}});if(g.length){ARIA2.remove(g)}if(f.length){ARIA2.remove_result(f)}},info:function(e){e.addClass("info-open");e.after(YAAW.tpl.info_box({gid:e.attr("data-gid")}));if(e.parents("#stoped-tasks-table").length){$("#ib-options-a").hide()}ARIA2.get_status(e.attr("data-gid"));ARIA2.select_lock(true)},info_close:function(e){$(".info-box").remove();$(".info-open").removeClass("info-open");if($(".tasks-table .task.selected").length==0){ARIA2.select_lock(false)}else{ARIA2.select_lock(true)}},},contextmenu:{init:function(){$(".task").live("contextmenu",function(g){$("#task-contextmenu").css("top",g.clientY).css("left",g.clientX).show();c=""+this.getAttribute("data-gid");var f=this.getAttribute("data-status");if(f=="waiting"||f=="paused"){$("#task-contextmenu .task-move").show()}else{$("#task-contextmenu .task-move").hide()}if(f=="removed"||f=="completed"||f=="error"){$(".task-restart").show();$(".task-start").hide()}else{$(".task-restart").hide();$(".task-start").show()}return false}).live("mouseout",function(f){if($.contains(this,f.toElement)||$("#task-contextmenu").get(0)==f.toElement||$.contains($("#task-contextmenu").get(0),f.toElement)){return}c=null;$("#task-contextmenu").hide()});$("#task-contextmenu a").click(function(){$("#task-contextmenu").hide()});var e=false;$("#task-contextmenu").hover(function(){e=true},function(){if(e){c=null;$("#task-contextmenu").hide()}})},restart:function(){if(c){ARIA2.restart_task([c,])}c=null},pause:function(){if(c){ARIA2.pause(c)}c=null},unpause:function(){if(c){ARIA2.unpause(c)}c=null},remove:function(){if(c){ARIA2.remove(c)}c=null},movetop:function(){if(c){ARIA2.change_pos(c,0,"POS_SET")}c=null},moveup:function(){if(c){ARIA2.change_pos(c,-1,"POS_CUR")}c=null},movedown:function(){if(c){ARIA2.change_pos(c,1,"POS_CUR")}c=null},moveend:function(){if(c){ARIA2.change_pos(c,0,"POS_END")}c=null},},setting:{init:function(){this.jsonrpc_path=$.Storage.get("jsonrpc_path")||"http://"+(location.host.split(":")[0]||"localhost")+":6800/jsonrpc";this.refresh_interval=Number($.Storage.get("refresh_interval")||10000);this.add_task_option=$.Storage.get("add_task_option");this.jsonrpc_history=JSON.parse($.Storage.get("jsonrpc_history")||"[]");if(this.add_task_option){this.add_task_option=JSON.parse(this.add_task_option)}if(location.hash&&location.hash.length){var e=location.hash.substring(1).split("&"),f={};$.each(e,function(h,j){j=j.split("=",2);f[j[0]]=j[1]});if(f.path){this.jsonrpc_path=f.path}this.kwargs=f}var g=this;$("#setting-modal").on("hidden",function(){g.update()});this.update()},save_add_task_option:function(e){this.add_task_option=e;$.Storage.set("add_task_option",JSON.stringify(e))},save:function(){$.Storage.set("jsonrpc_path",this.jsonrpc_path);if(this.jsonrpc_history.indexOf(this.jsonrpc_path)==-1){if(this.jsonrpc_history.push(this.jsonrpc_path)>10){this.jsonrpc_history.shift()}$.Storage.set("jsonrpc_history",JSON.stringify(this.jsonrpc_history))}$.Storage.set("refresh_interval",String(this.refresh_interval))},update:function(){$("#setting-form #rpc-path").val(this.jsonrpc_path);$("#setting-form input:radio[name=refresh_interval][value="+this.refresh_interval+"]").attr("checked",true);if(this.jsonrpc_history.length){var e='<ul class="dropdown-menu">';$.each(this.jsonrpc_history,function(g,f){e+='<li><a href="#">'+f+"</a></li>"});e+="</ul>";$(".rpc-path-wrap").append(e).on("click","li>a",function(){$("#setting-form #rpc-path").val($(this).text())});$(".rpc-path-wrap .dropdown-toggle").removeAttr("disabled").dropdown()}},submit:function(){_this=$("#setting-form");var g=_this.find("#rpc-path").val();var f=Number(_this.find("input:radio[name=refresh_interval]:checked").val());var h=false;if(g!=undefined&&this.jsonrpc_path!=g){this.jsonrpc_path=g;YAAW.tasks.unSelectAll();$("#main-alert").hide();YAAW.aria2_init();h=true}if(f!=undefined&&this.refresh_interval!=f){this.refresh_interval=f;ARIA2.auto_refresh(this.refresh_interval);h=true}if(h){this.save()}var e={};$("#aria2-gs-form input[name]").each(function(k,m){var j=m.getAttribute("name");var l=m.value;if(j&&l){e[j]=l}});ARIA2.change_global_option(e);$("#setting-modal").modal("hide")},},}})();YAAW.init();