if(typeof ARIA2=="undefined"||!ARIA2){var ARIA2=(function(){var m,j,k,a,l=0,b={};var o="",d="",p=false,f=false;var i=false;function c(q){if(typeof q=="string"){return q}else{if(typeof q.error=="string"){return q.error}else{if(q.error&&q.error.message){return q.error.message}}}}function n(q){var r=c(q);$("#main-alert .alert").attr("class","alert alert-error");$("#main-alert .alert-msg").html("<strong>Error: </strong>"+r);$("#main-alert").show()}function h(q,t,s){var r=(new Date()).getTime();$("#main-alert .alert").attr("class","alert "+q);$("#main-alert .alert-msg").html(t);$("#main-alert").data("msg_id",r).show();if(s){window.setTimeout(function(){if($("#main-alert").data("msg_id")==r){$("#main-alert").fadeOut()}},s)}return r}function g(q){q.find("[rel=tooltip]").tooltip({placement:"bottom"})}function e(q){var r=q.dir;var u="Unknown";if(q.bittorrent&&q.bittorrent.info&&q.bittorrent.info.name){u=q.bittorrent.info.name}else{if(q.files[0].path.replace(new RegExp("^"+r.replace("\\","[\\/]")+"/?"),"").split("/")[0]){u=q.files[0].path.replace(new RegExp("^"+r.replace("\\","[\\/]")+"/?"),"").split("/")[0]}else{if(q.files.length&&q.files[0].uris.length&&q.files[0].uris[0].uri){u=q.files[0].uris[0].uri}}}if(q.files.length>1){var t=0;for(var s=0;s<q.files.length;s++){if(q.files[s].selected=="true"){t+=1}}if(t>1){u+=" ("+t+" files..)"}}return u}return{init:function(s,r){var q=h("alert-info","connecting...");$("#add-task-option-wrap").empty().append(YAAW.tpl.add_task_option({}));$("#aria2-gsetting").empty().append(YAAW.tpl.aria2_global_setting({}));m=s||"http://"+(location.host.split(":")[0]||"localhost")+":6800/jsonrpc";if(m.indexOf("http")==0){j="http";$.jsonRPC.setup({endPoint:m,namespace:"aria2"});ARIA2.request=ARIA2.request_http;ARIA2.batch_request=ARIA2.batch_request_http;if(r){r()}if($("#main-alert").data("msg_id")==q){$("#main-alert").fadeOut()}}else{if(m.indexOf("ws")==0&&WebSocket){j="ws";k=new WebSocket(m);k.onmessage=function(t){var u=JSON.parse(t.data);if($.isArray(u)&&u.length){var v=u[0].id;if(b[v]){b[v].success(u);delete b[v]}}else{if(b[u.id]){if(u.error){b[u.id].error(u)}else{b[u.id].success(u)}delete b[u.id]}}};k.onerror=function(t){console.warn("error",t);h("alert-error","websocket error. you may need reflush this page to restart.");b={}};k.onopen=function(){ARIA2.request=ARIA2.request_ws;ARIA2.batch_request=ARIA2.batch_request_ws;if(r){r()}if($("#main-alert").data("msg_id")==q){$("#main-alert").fadeOut()}}}else{h("alert-error","Unknow protocol")}}},request:function(){},batch_request:function(){},request_http:function(t,s,r,q){if(q==undefined){q=n}$.jsonRPC.request(t,{params:s,success:r,error:q})},batch_request_http:function(u,t,s,r){if(r==undefined){r=n}var q=new Array();$.each(t,function(v,w){if(!$.isArray(w)){w=[w]}q.push({method:u,params:w})});$.jsonRPC.batchRequest(q,{success:s,error:r})},_request_data:function(t,r,s){var q={jsonrpc:"2.0",method:"aria2."+t,id:s};if(typeof(r)!=="undefined"){q.params=r}return q},_get_unique_id:function(){++l;return l},request_ws:function(u,s,r,q){var t=ARIA2._get_unique_id();b[t]={success:r||function(){},error:q||n,};k.send(JSON.stringify(ARIA2._request_data(u,s,t)))},batch_request_ws:function(q,u,y,x){var v=[];var r=ARIA2._get_unique_id();b[r]={success:y||function(){},error:x||n,};for(var w=0,t=u.length;w<t;w++){var s=u[w];if(!$.isArray(s)){s=[s]}v.push(ARIA2._request_data(q,s,r))}k.send(JSON.stringify(v))},main_alert:h,add_task:function(r,q){if(!r){return false}if(!$.isArray(r)){r=[r]}if(!q){q={}}ARIA2.request("addUri",[r,q],function(s){ARIA2.refresh();$("#add-task-modal").modal("hide");YAAW.add_task.clean()},function(s){var t=c(s);$("#add-task-alert .alert-msg").text(t);$("#add-task-alert").show();console.warn("add task error: "+t)})},madd_task:function(q,r){if(!$.isArray(q)){q=[q]}var t=[];for(var s=0;s<q.length;s++){t.push([[q[s]],r])}ARIA2.batch_request("addUri",t,function(u){var v=new Array();$.each(u,function(y,z){var x=c(z);if(x){v.push(x)}});if(v.length==0){ARIA2.refresh();$("#add-task-modal").modal("hide");YAAW.add_task.clean()}else{var w=v.join("<br />");$("#add-task-alert .alert-msg").html(w);$("#add-task-alert").show();console.warn("add task error: "+w)}})},add_torrent:function(r,q){if(!r){return false}if(!q){q={}}ARIA2.request("addTorrent",[r,[],q],function(s){ARIA2.refresh();$("#add-task-modal").modal("hide");YAAW.add_task.clean()},function(s){var t=c(s);$("#add-task-alert .alert-msg").text(t);$("#add-task-alert").show();console.warn("add task error: "+t)})},add_metalink:function(r,q){if(!r){return false}if(!q){q={}}ARIA2.request("addMetalink",[r,[],q],function(s){ARIA2.refresh();$("#add-task-modal").modal("hide");YAAW.add_task.clean()},function(s){var t=c(s);$("#add-task-alert .alert-msg").text(t);$("#add-task-alert").show();console.warn("add task error: "+t)})},restart_task:function(r){var q=[];$.each(r,function(u,t){var s=$("#task-gid-"+t).data("raw");$.each(s.files,function(w,v){if(v.uris.length){q.push(v.uris[0].uri)}})});if(q.length==0){h("alert-error","No files found! (BitTorrent tasks can't restart.)",2000)}else{if(q.length==1){$("#add-task-modal").modal("show");$("#uri-input").val(q[0])}else{$("#add-task-modal").modal("show");$("#add-task-uri .input-append").hide();$("#uri-textarea").val(q.join("\n")).show();$("#uri-more").text($("#uri-more").text().split("").reverse().join(""));$("#ati-out").parents(".control-group").val("").hide()}}},tell_active:function(q){if(p){return}ARIA2.request("tellActive",q,function(r){if(p){return}if(!r.result){h("alert-error","<strong>Error: </strong>rpc result error.",5000)}var s=new Array();$.each(r.result,function(t,u){s.push(u.gid)});if(s.sort().join(",")!=o){o=s.sort().join(",");f=true;if(i&&!p){ARIA2.refresh()}}r=ARIA2.status_fix(r.result);$("#active-tasks-table").empty().append(YAAW.tpl.active_task({tasks:r}));$.each(r,function(u,t){$("#task-gid-"+t.gid).data("raw",t)});g($("#active-tasks-table"))})},check_active_list:function(){ARIA2.request("tellActive",[["gid"]],function(q){if(!q.result){h("alert-error","<strong>Error: </strong>rpc result error.",5000)}var r=new Array();$.each(q.result,function(s,t){r.push(t.gid)});if(r.sort().join(",")!=o){o=r.sort().join(",");f=true;if(i&&!p){ARIA2.refresh()}}})},tell_waiting:function(q){if(p){return}var r=[0,1000];if(q){r.push(q)}ARIA2.request("tellWaiting",r,function(s){if(p){return}if(!s.result){h("alert-error","<strong>Error: </strong>rpc result error.",5000)}s=ARIA2.status_fix(s.result);$("#waiting-tasks-table").empty().append(YAAW.tpl.other_task({tasks:s}));$.each(s,function(u,t){$("#task-gid-"+t.gid).data("raw",t)});g($("#waiting-tasks-table"));if($("#other-tasks .task").length==0){$("#waiting-tasks-table").append($("#other-task-empty").text())}})},tell_stoped:function(q){if(p){return}var r=[0,1000];if(q){r.push(q)}ARIA2.request("tellStopped",r,function(s){if(!s.result){h("alert-error","<strong>Error: </strong>rpc result error.",5000)}if(p){return}s=ARIA2.status_fix(s.result);$("#stoped-tasks-table").empty().append(YAAW.tpl.other_task({tasks:s.reverse()}));$.each(s,function(u,t){$("#task-gid-"+t.gid).data("raw",t)});g($("#stoped-tasks-table"));if($("#waiting-tasks-table .empty-tasks").length>0&&$("#stoped-tasks-table .task").length>0){$("#waiting-tasks-table").empty()}})},status_fix:function(s){for(var r=0;r<s.length;r++){var q=s[r];q.title=e(q);if(q.totalLength==0){q.progress=0}else{q.progress=(q.completedLength*1/q.totalLength*100).toFixed(2)}q.etc=(q.totalLength-q.completedLength)/q.downloadSpeed;q.downloadSpeed=parseInt(q.downloadSpeed);q.uploadSpeed=parseInt(q.uploadSpeed);q.uploadLength=parseInt(q.uploadLength);q.completedLength=parseInt(q.completedLength);q.numSeeders=parseInt(q.numSeeders);q.connections=parseInt(q.connections)}return s},change_pos:function(r,s,q){ARIA2.request("changePosition",[r,s,q],function(t){h("alert-info","Moved",1000);ARIA2.refresh()})},pause:function(q){if(!$.isArray(q)){q=[q]}ARIA2.batch_request("pause",q,function(r){var s=new Array();$.each(r,function(u,v){var t=c(v);if(t){s.push(t)}});if(s.length==0){h("alert-info","Paused",1000);ARIA2.refresh()}else{h("alert-error",s.join("<br />"),3000)}})},unpause:function(q){if(!$.isArray(q)){q=[q]}ARIA2.batch_request("unpause",q,function(r){var s=new Array();$.each(r,function(u,v){var t=c(v);if(t){s.push(t)}});if(s.length==0){h("alert-info","Started",1000);ARIA2.refresh()}else{h("alert-error",s.join("<br />"),3000)}})},remove:function(q){if(!$.isArray(q)){q=[q]}ARIA2.batch_request("remove",q,function(r){var s=new Array();$.each(r,function(u,v){var t=c(v);if(t){s.push(t)}});if(s.length==0){h("alert-info","Removed",1000);ARIA2.refresh()}else{h("alert-error",s.join("<br />"),3000)}})},remove_result:function(q){if(!$.isArray(q)){q=[q]}ARIA2.batch_request("removeDownloadResult",q,function(r){var s=new Array();$.each(r,function(u,v){var t=c(v);if(t){s.push(t)}});if(s.length==0){h("alert-info","Removed",1000);ARIA2.tell_stoped()}else{h("alert-error",s.join("<br />"),3000)}})},get_options:function(q){ARIA2.request("getOption",[q],function(r){console.debug(r);$("#ib-options").empty().append(YAAW.tpl.ib_options(r.result));if($("#task-gid-"+q).attr("data-status")=="active"){$("#ib-options-form *[name]:not(.active-allowed)").attr("disabled",true)}})},change_options:function(r,q){ARIA2.request("changeOption",[r,q],function(s){h("alert-info","option updated",1000)})},pause_all:function(){ARIA2.request("pauseAll",[],function(q){ARIA2.refresh();h("alert-info","Paused all tasks. Please wait for action such as contacting BitTorrent tracker.",2000)})},unpause_all:function(){ARIA2.request("unpauseAll",[],function(q){ARIA2.refresh();h("alert-info","Unpaused all tasks.",2000)})},purge_download_result:function(){ARIA2.request("purgeDownloadResult",[],function(q){ARIA2.refresh();h("alert-info","Removed all completed/error/removed downloads tasks.",2000)})},get_global_option:function(){ARIA2.request("getGlobalOption",[],function(q){if(!q.result){h("alert-error","<strong>Error: </strong>rpc result error.",5000)}q=q.result;$("#aria2-gsetting").empty().append(YAAW.tpl.aria2_global_setting(q))})},init_add_task_option:function(){ARIA2.request("getGlobalOption",[],function(q){if(!q.result){h("alert-error","<strong>Error: </strong>rpc result error.",5000)}q=q.result;q["parameterized-uri"]=(q["parameterized-uri"]=="true"?true:false);$("#add-task-option-wrap").empty().append(YAAW.tpl.add_task_option(q))})},change_global_option:function(q){ARIA2.request("changeGlobalOption",[q],function(r){if(!r.result){h("alert-error","<strong>Error: </strong>rpc result error.",5000)}else{h("alert-success","Saved",2000)}})},global_stat:function(){ARIA2.request("getGlobalStat",[],function(q){if(!q.result){h("alert-error","<strong>Error: </strong>rpc result error.",5000)}q=q.result;var s=""+q.numActive+","+q.numWaiting+","+q.numStopped;if(s!=d){d=s;f=true;if(i&&!p){ARIA2.refresh()}}$("#global-speed").empty().append(YAAW.tpl.global_speed(q));var r="↓"+YAAW.tpl.view.format_size_0()(q.downloadSpeed);if(q.uploadSpeed>0){r+=" ↑"+YAAW.tpl.view.format_size_0()(q.uploadSpeed)}r+=" - Yet Another Aria2 Web Frontend";document.title=r})},get_version:function(){ARIA2.request("getVersion",[],function(q){if(!q.result){h("alert-error","<strong>Error: </strong>rpc result error.",5000)}$("#global-version").text("Aria2 "+q.result.version||"")})},get_status:function(q){ARIA2.request("tellStatus",[q],function(r){if(!r.result){h("alert-error","<strong>Error: </strong>rpc result error.",5000)}r=r.result;for(var t=0;t<r.files.length;t++){var s=r.files[t];s.title=s.path.replace(new RegExp("^"+r.dir+"/?"),"");s.selected=s.selected=="true"?true:false}$("#ib-status").empty().append(YAAW.tpl.ib_status(r));$("#ib-files").empty().append(YAAW.tpl.ib_files(r))})},change_option:function(r,q){ARIA2.request("changeOption",[r,q],function(s){if(!s.result){h("alert-error","<strong>Error: </strong>rpc result error.",5000)}else{h("alert-success","Change Options OK!",2000)}})},refresh:function(){if(!p){f=false;ARIA2.tell_active();ARIA2.tell_waiting();ARIA2.tell_stoped()}},select_lock:function(q){p=q},auto_refresh:function(q){if(a){window.clearInterval(a)}if(!(q>0)){i=false;return}a=window.setInterval(function(){ARIA2.global_stat();if(p){if(f){h("","Task list have changed since last update. Click 'Refresh' button to update task list.")}}else{if(f){ARIA2.refresh()}else{ARIA2.tell_active()}}},q);i=true},}})()};